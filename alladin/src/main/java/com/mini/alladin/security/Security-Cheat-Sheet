âœ… MINI-ALLADIN SPRING SECURITY â€” CHEAT SHEET

ğŸ” LOGIN OPTIONS:
1. Email + Password login â†’ /auth/login
2. Google OAuth2 login â†’ /oauth2/authorization/google

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“„ FILE RESPONSIBILITY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£  SecurityConfig.java
- Central security setup
- Defines:
    â€¢ Public endpoints
    â€¢ Role-based access
    â€¢ JWT filter + OAuth2 configs
- Registers:
    â€¢ JwtAuthenticationFilter
    â€¢ CustomOAuth2UserService
    â€¢ OAuth2LoginSuccessHandler
    â€¢ DaoAuthenticationProvider

2ï¸âƒ£ AuthController.java
- Handles /auth/login
- Verifies user credentials
- If OK: generate JWT + store in cookie
- Redirect to /admin/... or /trader/...

3ï¸âƒ£ JwtTokenProvider.java
- Generates JWT with email
- Validates token
- Extracts email from token
- Uses secret + expiry from application.properties

4ï¸âƒ£ JwtAuthenticationFilter.java
- Runs before every request
- Checks for JWT:
    â€¢ Authorization Header
    â€¢ OR Cookie named "jwt"
- If valid:
    â€¢ Load user from DB
    â€¢ Set Spring Security context

5ï¸âƒ£ CustomUserDetailsService.java
- Loads user from DB by email
- Wraps into CustomUserDetails

6ï¸âƒ£ CustomUserDetails.java
- Adapter that maps our User entity â†’ Spring Security format
- Uses isActive() for blocked status

7ï¸âƒ£ CustomOAuth2UserService.java
- Runs after Google login
- Extracts email/name from Google
- If user doesn't exist â†’ creates one with TRADER role

8ï¸âƒ£ OAuth2LoginSuccessHandler.java
- Runs after Google login success
- Generates JWT
- Adds cookie "jwt"
- Redirects to correct dashboard based on role

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¤ LOGIN FLOW (EMAIL + PASSWORD)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
User â†’ /auth/login (POST)
â†’ AuthController â†’ AuthenticationManager
â†’ CustomUserDetailsService â†’ CustomUserDetails
â†’ If success: generate JWT â†’ store in cookie
â†’ Redirect to /admin/... or /trader/...

â†’ Future requests:
â†’ JwtAuthenticationFilter â†’ Validates token â†’ Sets context â†’ Access granted

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒ LOGIN FLOW (GOOGLE OAUTH2)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
User â†’ /oauth2/authorization/google
â†’ Google Login Success â†’ CustomOAuth2UserService
â†’ If user doesn't exist â†’ save as TRADER
â†’ OAuth2LoginSuccessHandler â†’ generate JWT â†’ store in cookie
â†’ Redirect to /admin/... or /trader/...

â†’ Future requests:
â†’ JwtAuthenticationFilter â†’ Validates token â†’ Sets context â†’ Access granted

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš« BLOCKED USER HANDLING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Blocked if isActive = false
- Checked in:
    â€¢ AuthController.java â†’ blocks login
    â€¢ JwtAuthenticationFilter.java â†’ blocks token access
- Blocked users get redirect to /login?blocked=true

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¬ UNBLOCK SYSTEM
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
- Admin can block/unblock users (toggle)
- If blocked:
    â†’ Email sent with unblock link
    â†’ Clicking link â†’ sets isActive = true
